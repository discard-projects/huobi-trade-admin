webpackJsonp([7],{q9zA:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("AISp"),r={mixins:[n("gMjF").a]},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"名称",prop:"name"}},[n("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"路径",prop:"api"}},[n("el-input",{model:{value:t.form.api,callback:function(e){t.$set(t.form,"api",e)},expression:"form.api"}})],1),t._v(" "),t.originForm?n("el-form-item",{attrs:{label:"上级归属",prop:"parent_id"}},[n("ex-model-select",{attrs:{"default-value":t.form.parent_id,api:"/permissions",labelKey:"string_name_with_parents"},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}})],1):t._e(),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",loading:t.uploading,disabled:t.fetching},on:{click:function(e){return t.onSubmit("form")}}},[t._v(t._s(t.form.id?"更新":"创建"))]),t._v(" "),t.form.id?t._e():n("el-button",{on:{click:function(e){return t.onReset("form")}}},[t._v("重置")])],1)],1)},staticRenderFns:[]},a=n("C7Lr")(r,o,!1,null,null,null).exports,s={props:{item:{required:!1}},data:function(){return{dialogVisible:!0,form:{name:"",api:"",parent_id:""}}},watch:{item:{handler:function(t){t&&(this.form.parent_id=t.id)},immediate:!0}},methods:{handler:function(){var t=this;return this.api.createPermission(this.form).then(function(e){e.data;t.$root.owner.fetchData(),t.$ext.unmount(t)})}},components:{innerForm:a}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:"新增",visible:t.dialogVisible,width:"80%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("inner-form",{attrs:{form:t.form,handler:t.handler}})],1)},staticRenderFns:[]},c=n("C7Lr")(s,l,!1,null,null,null).exports,m={mixins:[n("gf7+").a],methods:{fetchData:function(){return this._fetchData(this.api.getPermission(this.item.id))},handler:function(){return this._handler(this.api.updatePermission(this.item.id,this.form))}},components:{innerForm:a}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:"编辑",visible:t.dialogVisible,width:"80%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("inner-form",{attrs:{form:t.form,handler:t.handler,fetching:t.fetching}})],1)},staticRenderFns:[]},u=n("C7Lr")(m,f,!1,null,null,null).exports,d={mixins:[i.a],data:function(){return{footprints:[],treeData:null}},methods:{fetchData:function(){var t=this;this.api.getPermissionTree({per_page:99999999999}).then(function(e){t.treeData=e.data.items})},showNewDialog:function(t){this.$ext.mount(c,{onEl:this.$el,data:{owner:this},props:{item:t}})},fetchItemFootprints:function(t){var e=this;this.api.getPermissionFootprints(t.id).then(function(t){e.footprints=t.data.items})},showEditDialog:function(t){this.$ext.mount(u,{onEl:this.$el,props:{item:t},data:{owner:this}})},destroy:function(t){var e=this;this.$confirm("确定要删除该条信息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",callback:function(n){"confirm"===n&&(e.$set(t,"deleting",!0),e.api.deletePermission(t.id).then(function(n){e.$set(t,"deleting",!1),e.$message.success("删除成功了！"),e.fetchData()}).catch(function(n){console.error(n),e.$message.error("删除报错了！"),e.$set(t,"deleting",!1)}))}})}},created:function(){this.fetchData()}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{margin:"15px"}},[n("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"primary"},on:{click:t.showNewDialog}},[t._v("新增")]),t._v(" "),n("el-tree",{ref:"treeRef",attrs:{data:t.treeData,"default-expand-all":"","node-key":"id"},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var i=e.data;return n("span",{},[n("span",[t._v(t._s(i.name))]),t._v(" "),n("div",{staticStyle:{display:"inline-block"}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.showNewDialog(i)}}},[t._v("新增")]),t._v(" "),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.showEditDialog(i)}}},[t._v("编辑")]),t._v(" "),n("el-button",{staticStyle:{color:"#f44"},attrs:{size:"mini",type:"text"},on:{click:function(e){return t.destroy(i)}}},[t._v("删除")])],1)])}}])})],1)},staticRenderFns:[]},h=n("C7Lr")(d,p,!1,null,null,null);e.default=h.exports}});